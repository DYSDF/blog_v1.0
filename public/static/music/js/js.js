require(["ScrollText"],function(a){[].forEach.call(document.getElementsByClassName("scroll_text"),function(b){a(b)}.bind(this))});(function(){function a(){document.getElementById("content").style.height=document.documentElement.offsetHeight-50+"px"}window.addEventListener("resize",a);a()})();require(["DYUtils"],function(g){var f=document.getElementById("content"),i=document.documentElement.offsetHeight-50,j=i-60,b,l,c,k,h,a;function e(n){var m=a+n;m=m>i?i:(m<j?j:m);f.style.height=m+"px"}function d(){a=f.offsetHeight;if(i+j>a*2){e(j-a-1)}else{e(i-f.offsetHeight+1)}}g.bindEvent(f,"mousedown",function(m){b=true;m=m||window.event;c={x:m.clientX,y:m.clientY};a=f.offsetHeight});g.bindEvent(f,"mousemove",function(m){if(!b){return}m=m||window.event;if(l){f.style.transition="height 0ms ease-in-out";e((m.clientY-c.y)/2)}else{k=m.clientX-c.x;h=m.clientY-c.y;if(Math.abs(k)<10&&Math.abs(h)<10){return}Math.abs(k)>Math.abs(h)?(l=false):(l=true)}});g.bindEvent(f,"mouseup",function(m){l=false;b=false;f.style.transition="";d()});g.bindEvent(window,"resize",g.deBounce(function(m){i=document.documentElement.offsetHeight-50;j=i-60},1000));g.bindEvent(f,"selectstart",function(m){m.preventDefault()})});require(["DYUtils"],function(h){var e=document.getElementById("content"),g=document.getElementById("songPanel"),b=document.getElementById("listopen"),k=1,r=0,s=/matrix\(((\d+\.?\d*),\s){5}\d+\.?\d*\)/,i,n,f,d,c,l;function o(){return h.hasClassName(g,"open")}function j(t){var u=(l+t)/g.offsetWidth;u=u>k?k:(u<r?r:u);g.style.transform="translate3d("+u*100+"%, 0, 0)"}function q(){if(!o()){h.addClassName(g,"open");h.addClassName(b,"openlist");h.removeEvent(e,"mouseup touchstart",m);h.oneEvent(e,"mouseup touchstart",m)}}function m(){if(o()){h.removeClassName(g,"open");h.removeClassName(b,"openlist")}}function a(){if(o()){m()}else{q()}}function p(){if(Number(h.getCssValue(g,"transform").match(s)[2])/g.offsetWidth>0.5){m()}else{q()}g.style.transform=""}h.bindEvent(e,"mousedown touchstart",function(t){i=true;t=t.touches?t.touches[0]:(t||window.event);f={x:t.clientX,y:t.clientY};l=Number(h.getCssValue(g,"transform").match(s)[2]);m()});h.bindEvent(e,"mousemove touchmove",function(t){if(!i){return}t=t.touches?t.touches[0]:(t||window.event);if(n){g.style.transition="all 0ms linear";j((t.clientX-f.x)/1.2)}else{d=t.clientX-f.x;c=t.clientY-f.y;if(Math.abs(d)<10&&Math.abs(c)<10){return}Math.abs(d)<Math.abs(c)?(n=false):(n=true)}});h.bindEvent(e,"mouseup touchend",function(t){if(n){n=false;p()}g.style.transition="";i=false});h.bindEvent(b,"mousedown",function(t){t.stopPropagation()});h.bindEvent(b,"mouseup",function(t){t.stopPropagation();a()});h.bindEvent(g,"mousedown touchstart",function(t){t.stopPropagation()})});require(["DYUtils","SimpleMusicPlayer","ScrollText"],function(j,k,t){var f=new k();var d=[];var b=0;var a={};var s=0;var l;var p;function h(v){var w=document.createElement("ol");var u="";u+="<div id='back'>返回上一层</div>";a[v].forEach(function(y,x,z){u+='<li data-id="'+x+"\" data-songIndex='"+v+"' class='play_list_li'><div class=\"musicName\">"+y.name+'</div><div class="musicTime">'+formatTime(y.duration/1000)+"</div></li>"});w.innerHTML=u;document.getElementById("songlist").innerHTML=w.outerHTML;j.addClassName(document.getElementById("songContainer"),"open");if(b==v){g()}}function c(x){if(!a[x]||a[x].length===0){var w=j.toObject(j.getLocalStorage("playList"));var u=j.getLocalStorage("playListUpdateTime")*1;var v=new Date().getDate();if(!w||!w[x]||w[x].length===0||u<v){j.ajax({url:"/music/toplist",method:"POST",data:{playlistId:x,timestamp:new Date().getTime()},beforeSend:function(y){y.setRequestHeader("X-CSRFToken",j.getCookie("csrftoken"))},success:function(y){a[x]=JSON.parse(y);j.setLocalStorage("playList",JSON.stringify(a));j.setLocalStorage("playListUpdateTime",new Date().getDate());h(x)},error:function(){alert("获取歌曲列表失败")}})}else{a=w;h(x)}}else{h(x)}}function i(){var v=document.createElement("ol");var u="";for(var w in d){u+="<li class='song_list_li' data-id=\""+d[w].id+'"><div class="playlistName">《'+d[w].name+"》</div></li>"}v.innerHTML=u;document.getElementById("playlist").innerHTML=v.outerHTML}function q(){var v=j.toObject(j.getLocalStorage("songList")),u=j.getLocalStorage("songListUpdateTime")*1,w=new Date().getDate();if(!v||v.length===0||u<w){j.ajax({url:"/music/playlist",method:"POST",data:{timestamp:new Date().getTime()},beforeSend:function(x){x.setRequestHeader("X-CSRFToken",j.getCookie("csrftoken"))},success:function(x){d=JSON.parse(x);i();j.setLocalStorage("songList",JSON.stringify(x));j.setLocalStorage("songListUpdateTime",w)},error:function(){alert("获取歌单列表失败")}})}else{d=v;i()}}function m(u){try{var w=a[b][s].id;j.ajax({url:"/music/getLyric",method:"POST",data:{songId:w},beforeSend:function(x){x.setRequestHeader("X-CSRFToken",j.getCookie("csrftoken"))},success:function(y){var x=JSON.parse(y);if(u){u(e(x))}},error:function(){if(u){u(e({0:"暂无歌词"}))}}})}catch(v){if(u){u(e({0:"暂无歌词"}))}}}function e(B){var G={};try{var v=B.split("\n");for(var y=0;y<v.length;y++){var I=decodeURIComponent(v[y]);var D=/\[\d*:\d*((\.|\:)\d*)*\]/g;var A=I.match(D);if(!A){continue}var F=I.replace(D,"");if(F==""||F==undefined){continue}for(var w=0,z=A.length;w<z;w++){var H=A[w];var x=Number(String(H.match(/\[\d*/i)).slice(1)),C=Number(String(H.match(/\:\d*/i)).slice(1));var u=x*60+C;G[u]=F}}}catch(E){G={0:"暂无歌词"}}return G}function r(A){var y=document.createElement("ul"),x;var u="";for(var w in A){u+="<li id='lrc_time_"+w+"' class='lrc_content'>"+A[w]+"</li>"}y.innerHTML=u;document.getElementById("songlrc").innerHTML=y.outerHTML;[].slice.call(document.getElementsByClassName("lrc_content")).forEach(function(B){t(B)});x=document.querySelector("#songlrc ul").offsetHeight/Object.keys(A).length;p={};var z=Object.keys(A);for(var v=0;v<z.length;v++){p[z[v]]=v*x}}function o(w){try{var u=p[w];if(u){document.querySelector("#songlrc ul").style.transform="translate3d(0,"+-u+"px,0)";j.removeClassName(document.getElementsByClassName("lrc_content"),"on");j.addClassName(document.getElementById("lrc_time_"+w),"on")}}catch(v){}}function n(){[].slice.call(document.getElementsByClassName("song_list_li")).forEach(function(u){if(u.dataset.id==b){j.addClassName(u,"cur")}else{j.removeClassName(u,"cur")}})}function g(){[].slice.call(document.getElementsByClassName("play_list_li")).forEach(function(u){if(u.dataset.id==s){j.addClassName(u,"cur")}else{j.removeClassName(u,"cur")}})}q();j.bindEvent(document.getElementById("playlist"),"click",function(v){v=v||window.event;var u=v.target;[].slice.call(document.getElementsByClassName("song_list_li")).forEach(function(x,w,y){if(j.isChildNode(u,x)){c(x.dataset.id)}})});j.bindEvent(document.getElementById("songlist"),"click",function(v){v=v||window.event;var u=v.target;if(j.isChildNode(u,document.getElementById("back"))){j.removeClassName(document.getElementById("songContainer"),"open")}});j.bindEvent(document.getElementById("songlist"),"click",function(v){v=v||window.event;var u=v.target;[].slice.call(document.getElementsByClassName("play_list_li")).forEach(function(x,w,y){if(j.isChildNode(u,x)){b=x.dataset.songindex;s=x.dataset.id;f.setSongList(a[b]);f.play(s);n();g()}})});j.bindEvent(document.getElementById("control_play"),"click",function(){if(f.isPaused()){f.play()}else{f.pause()}});j.bindEvent(document.getElementById("control_prev"),"click",function(){f.prev()});j.bindEvent(document.getElementById("control_next"),"click",function(){f.next()});j.bindEvent(document.getElementById("control_vol"),"click",function(){f.mute()});j.bindEvent(document.getElementById("control_vol"),"mousewheel DOMMouseScroll",function(u){u=u||window.event;var v=(u.wheelDelta&&(u.wheelDelta>0?1:-1))||(u.detail&&(u.detail>0?-1:1));if(v>0){f.volPlus()}else{f.volSub()}});f.listener("playing",function(){j.addClassName(document.getElementById("control_play"),"control_pause");j.removeClassName(document.getElementById("control_ablum"),"rotate_stop")});f.listener("pause",function(){j.removeClassName(document.getElementById("control_play"),"control_pause");j.addClassName(document.getElementById("control_ablum"),"rotate_stop")});f.listener("timeupdate",j.deFrames(function(){document.getElementById("durCurTime").innerHTML=formatTime(this.currentTime)},1000,true));f.listener("timeupdate",j.deFrames(function(){document.querySelector("#durprogress .progress").style.width=this.currentTime/this.duration*100+"%"},1000,true));f.listener("timeupdate",function(){var u=Math.floor(this.currentTime);o(u)});f.listener("change",function(u){s=u;g()});f.listener("canplay",function(){m(function(u){l=u;r(u)})});f.listener("canplay",function(){document.getElementById("durTolTime").innerHTML=formatTime(this.duration)});f.listener("canplay",function(){var w=a[b][s];if(w){var x=w.name,v=w.artists,u=w.album.name;document.getElementById("music_name").innerHTML=" 《"+x+"》 ";document.querySelector("#music_ablum span").innerHTML=u;document.querySelector("#music_art span").innerHTML=v.map(function(y){return y.name}).join("/");document.querySelector("#control_ablum").style.backgroundImage="url("+w.album.picUrl+")";document.querySelector("#blur_img").style.backgroundImage="url("+w.album.blurPicUrl+")"}});f.listener("volumechange",function(){if(this.muted){j.addClassName(document.getElementById("control_vol"),"muted")}else{j.removeClassName(document.getElementById("control_vol"),"muted")}});f.listener("volumechange",function(){document.getElementById("control_vol").dataset.vol=parseInt(this.volume*100)});j.bindEvent(document.getElementById("songContainer"),"mouseup",function(u){u=u||window.event;j.stopBubble(u)})});function formatTime(a){return[parseInt(a/60),Math.round(a%60)].join(":").replace(/\b(\d)\b/g,"0$1")}function getRandom(d,c){var f=Math.min(d,c);var e=Math.max(d,c)-Math.min(d,c);return Math.floor(Math.random()*(e+1))+f};