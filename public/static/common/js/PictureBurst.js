define(["DYUtils","Tween"],function(c,h){function d(j,i){return Math.floor(Math.random()*i)+(j-i/2)}function g(k){var i=document.createElement("canvas");var j=i.getContext("2d");i.width=k.width;i.height=k.height;j.drawImage(k,0,0,k.width,k.height);return i}function f(k,t,r){var n=k.width;var o=k.height;var p=[];var s=n/t;var q=o/r;for(var m=0;m<=t;m++){p[m]=[];for(var l=0;l<=r;l++){p[m].push({x:m*s,y:l*q})}}p.forEach(function(j,i){j.forEach(function(w,v){var u=d(w.x,s);var z=d(w.y,q);if(i>0&&i<t){w.x=u}if(v>0&&v<r){w.y=z}})});return p}function b(o,r,q,l){r=r||1;q=q||1;l=l||1;var n=[];var A=f(o,r,q);var s=g(o).getContext("2d");var m=document.createElement("canvas");var k=m.getContext("2d");for(var v=0;v<A.length-1;v++){n[v]=[];for(var u=0;u<A[v].length-1;u++){var B=Math.min(A[v][u].x,A[v][u+1].x,A[v+1][u].x,A[v+1][u+1].x);var x=Math.min(A[v][u].y,A[v][u+1].y,A[v+1][u].y,A[v+1][u+1].y);var z=Math.max(A[v][u].x,A[v][u+1].x,A[v+1][u].x,A[v+1][u+1].x);var w=Math.max(A[v][u].y,A[v][u+1].y,A[v+1][u].y,A[v+1][u+1].y);m.width=z-B+2*l;m.height=w-x+2*l;k.save();k.fillStyle="black";k.strokeStyle="black";k.lineWidth=1+l;k.lineCap="round";k.lineJoin="round";k.translate(l-B,l-x);k.beginPath();k.moveTo(A[v][u].x,A[v][u].y);k.lineTo(A[v+1][u].x,A[v+1][u].y);k.lineTo(A[v+1][u+1].x,A[v+1][u+1].y);k.lineTo(A[v][u+1].x,A[v][u+1].y);k.closePath();k.stroke();k.fill();k.restore();var y=s.getImageData(B-l,x-l,z-B+2*l,w-x+2*l);var t=document.createElement("canvas");var p=t.getContext("2d");t.width=z-B+2*l;t.height=w-x+2*l;p.putImageData(y,0,0);var C=new Image();C.src=t.toDataURL();k.globalCompositeOperation="source-in";k.save();k.translate(-l,-l);k.drawImage(C,0,0);k.restore();n[v][u]={sX:d(B-l,window.screen.availWidth*2),sY:d(x-l,window.screen.availHeight*2),eX:B,eY:x,imgData:m.toDataURL()}}}return n}var e=(function(){var i;return function(j){if(!i){i=document.createElement("canvas");i.width=window.screen.availWidth;i.style.width=window.screen.availWidth+"px";i.height=window.screen.availHeight;i.style.height=window.screen.availHeight+"px";i.style.position="fixed";i.style.top="0";i.style.left="0";i.style.zIndex=c.getCssValue(j,"z-index");j.parentElement.appendChild(i)}return i}})();function a(j,v){if(Object.prototype.toString.call(j)!=="[object HTMLImageElement]"){throw"非 img 元素"}v=v||{};var i=v.onEnd||function(){};var u=false,l=e(j),k=l.getContext("2d"),m=b(j,v.countX,v.countY,v.expand),A=j.getBoundingClientRect().top,q=j.getBoundingClientRect().left,y=j.getBoundingClientRect().width/2,n=j.getBoundingClientRect().height/2,t=q+y,s=A+n;var z=v.rotate!=undefined?v.rotate:Math.PI;var w;var p;function B(){var C=Date.now()-w;if(C>=p){C=p;u=true;setTimeout(function(){l.style.display="none";i()},0)}k.clearRect(0,0,l.width,l.height);k.save();k.translate(t,s);k.rotate(h.Sine.easeIn(C,0,z,p));k.save();k.translate(-y,-n);m.forEach(function(D){D.forEach(function(F){var E=document.createElement("img");E.src=F.imgData;k.drawImage(E,h.Sine.easeIn(C,F.eX,F.sX-F.eX,p),h.Sine.easeIn(C,F.eY,F.sY-F.eY,p))})});k.restore();k.restore();if(!u){c.fastAnimation(arguments.callee)}}function r(){var C=Date.now()-w;if(C>=p){C=p;u=true;setTimeout(function(){l.style.display="none";i()},0)}k.clearRect(0,0,l.width,l.height);k.save();k.translate(t,s);k.rotate(h.Cubic.easeOut(C,z,0-z,p));k.save();k.translate(-y,-n);m.forEach(function(D){D.forEach(function(F){var E=document.createElement("img");E.src=F.imgData;k.drawImage(E,h.Cubic.easeOut(C,F.sX,F.eX-F.sX,p),h.Cubic.easeOut(C,F.sY,F.eY-F.sY,p))})});k.restore();k.restore();if(!u){c.fastAnimation(arguments.callee)}}function x(C){l.style.display="";u=false;w=Date.now();p=C||800;B()}function o(C){l.style.display="";u=false;w=Date.now();p=C||800;r()}return{burst:x,gather:o}}if(!window.PictureBurst){window.PictureBurst=a}return a});